unit frmMaildlg;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, FWSQLBaseDlgfrm, Data.FMTBcd,
  IdBaseComponent, IdComponent, IdTCPConnection, IdTCPClient,
  IdExplicitTLSClientServerBase, IdMessageClient, IdSMTPBase, IdSMTP,
  Vcl.StdCtrls, Vcl.ComCtrls, Vcl.ExtCtrls, Vcl.Grids, Vcl.Buttons, Data.DB,
  Data.SqlExpr, IdMessage;

type
  TMailDlgframe = class(TFWSQLBaseDialogframe)
    btnSend: TSpeedButton;
    pnlAddress: TPanel;
    StringGrid1: TStringGrid;
    Splitter1: TSplitter;
    pnlContents: TPanel;
    pnlSubject: TPanel;
    lblSubject: TLabel;
    edtSubject: TEdit;
    pnlContentsTitle: TPanel;
    memoContents: TRichEdit;
    IdSMTP1: TIdSMTP;
    IdMessage1: TIdMessage;
    procedure btnSendClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  MailDlgframe: TMailDlgframe;

implementation

{$R *.dfm}

procedure TMailDlgframe.btnSendClick(Sender: TObject);
var
  subject, from, mailto, body: string;
  msg: TIdMessage;
  IdSMTP: TIdSMTP;
begin
  inherited;
  IdSMTP := TIdSMTP.Create(nil);
  IdSMTP.Port      := 465;  //OPB25
  IdSMTP.Host      := 'ptnsmtp.mail.yahoo.co.jp';
  IdSMTP.Username  :=   'qfxqh672';
  IdSMTP.Password  := 'WwyFxyff';

  subject := edtSubject.Text;
  from    := 'a0441338@sophia.jp';
  mailto  := 'a0441338@sophia.jp';

  body    := memoContents.Lines.Text;

  msg := TIdMessage.Create(IdSmtp);
  try
    msg.Subject := subject;
    msg.Recipients.EMailAddresses := mailto;
    msg.From.Text := from;
    msg.Body.Text := body;
    msg.ContentType := 'text/plain';

    IdSmtp.Connect;
    IdSmtp.Send(msg);
    IdSmtp.Disconnect ;
  finally
    msg.Free;
  end;
end;

end.
